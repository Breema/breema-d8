id: breema_csv_media_image_entity
label: Image entities from CSV input
migration_tags:
  - Breema CSV
  - media
  - image

destination:
  plugin: entity:media

source:
  plugin: csv
  path: 'public://csv/media-image-files.csv'
  header_row_count: 0
  keys:
    - filepath
  column_names:
    0:
      filepath: File path

process:
  bundle:
    plugin: default_value
    default_value: image
  name: filepath
  status:
    plugin: default_value
    default_value: 1
  uid:
    plugin: default_value
    default_value: 1
  'field_media_image/target_id':
    plugin: migration_lookup
    no_stub: true
    migration: breema_csv_media_image_file
    source: filepath
  'field_media_image/alt': filepath
  image_type:
    plugin: callback
    callable: breema_migrate_image_path_to_type
    source: filepath
  'field_image_type/target_id':
    plugin: migration_lookup
    no_stub: true
    migration: breema_csv_media_image_type
    source: '@image_type'

migration_dependencies:
  required:
    - breema_csv_media_image_type
    - breema_csv_media_image_file
  optional: {}
