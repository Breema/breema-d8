id: breema_csv_directory_entry
label: Directory entries from CSV data dump
migration_tags:
  - Breema CSV
source:
  plugin: csv
  path: public://csv/breema-directory-data.csv
  header_row_count: 1
  keys:
    - email
  column_names:
    0:
      last_name: Last Name
    1:
      first_name: First Name
    2:
      email: Email
    3:
      phone_cell: Cell phone
    4:
      phone_main: Main phone
    5:
      phone_work: Work phone
    6:
      country: Country
    7:
      state: State
    8:
      city: City
    9:
      postal_code: Postal code
    10:
      practitioner: Practitioner
    11:
      self_breema_provisional: Provisional Self-Breema Instructor
    12:
      self_breema: Certified Self-Breema Instructor
    13:
      provisional_instructor: Provisional Instructor
    14:
      full_instructor: Full Instructor
process:
  # The content (node) type we are creating is 'directory_entry'.
  type:
    plugin: default_value
    default_value: directory_entry
  uid:
    plugin: default_value
    default_value: 1
  revision_uid:
    plugin: default_value
    default_value: 1
  title:
    plugin: concat
    source:
      - first_name
      - last_name
    delimiter: ' '
  field_name_first: first_name
  field_name_last: last_name
  'field_address/country_code':
    plugin: callback
    callable: breema_migrate_map_country_to_code
    source: country
  'field_address/administrative_area': state
  'field_address/locality': city
  'field_address/postal_code': postal_code
  field_breema_center_staff:
    plugin: default_value
    default_value: false
  field_breema_clinic_practitioner:
    plugin: default_value
    default_value: false
  field_job_title:
    plugin: default_value
    default_value: ''
  field_email: email
destination:
  # Here we're saying that each row of data (line from the CSV file) will be
  # used to create a node entity.
  plugin: entity:node
# List any optional or required migration dependencies.
# Requried means that 100% of the content must be migrated
# Optional means that that the other dependency should be run first
# but if there are items from the dependant migration that were not
# successful, it will still run the migration.
migration_dependencies:
  required: {}
  optional: {}

