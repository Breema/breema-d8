<?php

/**
 * @file
 * Contains breema_migrate.module.
 */

use CommerceGuys\Addressing\Country\CountryRepositoryInterface;

/**
 * Migration callback function to map country names to country codes.
 */
function breema_migrate_map_country_to_code($source_country) {
  static $country_map = array();
  if (empty($country_map)) {
    $country_repository = \Drupal::service('address.country_repository');
    $country_map = $country_repository->getList();
    $country_map = array_map('strtolower', $country_map);
  }

  if (empty($source_country)) {
    return 'US';
  }
  return array_search(strtolower($source_country), $country_map);
}

/**
 * Migration callback function to handle Instructor certification fields.
 */
function breema_migrate_certification($source) {
  // By default, all entries are certified practitioners.
  $certification = ['practitioner'];
  if ($source != '---') {
    // If *any* of the instructor certification columns are set, turn on
    // Self-Breema instructor.
    $certification[] = 'inst-self-breema';
    // Now, see if either provisional or full instructor are set:
    $source_certifications = explode('-', $source);
    if (!empty($source_certifications[2]) || !empty($source_certifications[3])) {
      $certification[] = 'inst-breema';
    }
  }
  return $certification;
}
